---
import { ClientRouter } from 'astro:transitions';
import BetterIcon from '../components/ui/BetterIcon.astro'
import DarkLightController from '../components/ui/DarkLightController.astro'
import Navbar from '../components/ui/Navbar.astro'
import Head from '../components/Head.astro'
import { seo, profile, template } from '../settings'
import Footer from '../components/ui/Footer.astro'

type Props = {
  title?: string
  description?: string
  image?: string
}

const {
  title = seo.default_title,
  description = seo.default_description,
  image = seo.default_image,
} = Astro.props
---

<!doctype html>
<html lang="en">
  <head>
    {template.transitions && <ClientRouter />}
    <Head title={title} description={description} image={image} />

    <!-- Theme bootstrap: set data-theme ASAP to avoid flash -->
    <script is:inline>
      (() => {
        const stored = typeof localStorage !== "undefined" ? localStorage.getItem("theme") : null;
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;

        const theme = stored || (prefersDark ? "cosmin-dark" : "cosmin");

        // DaisyUI source of truth
        document.documentElement.setAttribute("data-theme", theme);

        // Optional compatibility if you still use Tailwind `dark:` anywhere
        document.documentElement.classList.toggle("cosmin-dark", theme === "cosmin-dark");
      })();
    </script>

  </head>

  <body class="min-h-screen">
    <div class={`drawer lg:drawer-open ${template.menu_left ? 'drawer-end' : ''}`}>
      <input id="my-drawer" type="checkbox" class="drawer-toggle" />

      <!-- Add text-base-content so *everything* inherits correct color -->
      <div class="drawer-content bg-base-100 text-base-content transition-colors duration-300">
        <div class="sticky top-0 z-50 bg-base-100/80 backdrop-blur-md border-b border-base-200/50">
			<nav class="navbar max-w-5xl mx-auto min-h-[3rem] px-2">
				<div class="navbar-start">
              {template.menu_left && <DarkLightController />}
              <label for="my-drawer" class="btn btn-square btn-ghost lg:hidden">
                <BetterIcon>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-6 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
                  </svg>
                </BetterIcon>
              </label>
            </div>

			<div class="navbar-start lg:flex hidden">
				<span class="text-sm font-extrabold tracking-tight text-base-content/80">
				  {profile.fullName}
				</span>
			</div>

            <div class="navbar-end">
              {!template.menu_left && <DarkLightController />}
            </div>
          </nav>
        </div>

		<main class="p-2 lg:px-12 lg:pt-2 lg:pb-12 lg:max-w-5xl max-w-full mx-auto min-h-screen flex flex-col">
			<div class="flex-grow">
            <slot />
          </div>
          <Footer />
        </main>
      </div>

      <div class="drawer-side z-40">
        <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <Navbar />
      </div>
    </div>
  </body>
</html>

<style is:global>
  /* === Best-practice: DaisyUI controls theme via data-theme ===
     Make the base page colors follow DaisyUI tokens.
  */

  html, body {
    margin: 0;
    background-color: hsl(var(--b1)); /* bg-base-100 */
    color: hsl(var(--bc));            /* text-base-content */
  }

  /* Ensure common typography elements inherit the base content color */
  h1, h2, h3, h4, h5, h6 {
    color: inherit;
  }

  p, li, span, small, blockquote, code, pre {
    color: inherit;
  }

  /* If you use @tailwindcss/typography (class="prose"), it often sets its own colors.
     This forces prose to follow DaisyUI theme tokens without hardcoding light/dark. */
  .prose {
    color: hsl(var(--bc));
    max-width: 100%;
  }

  .prose :where(h1, h2, h3, h4, h5, h6) {
    color: hsl(var(--bc));
  }

  .prose :where(a) {
    color: hsl(var(--p)); /* DaisyUI 'primary' */
    text-decoration: none;
  }
  .prose :where(a:hover) {
    text-decoration: underline;
  }

  .prose :where(strong) {
    color: hsl(var(--bc));
  }

  .prose :where(code) {
    color: hsl(var(--bc));
  }

  /* Optional: make subtle text consistent without using slate classes */
  .text-muted {
    color: hsl(var(--bc) / 0.7);
  }

  /* Optional: avoid weird “glow” feeling by ensuring shadows are not theme-breaking.
     Prefer DaisyUI shadow classes in markup; this is just a safe baseline. */
  .shadow-xl, .shadow-2xl {
    box-shadow: 0 20px 25px -5px hsl(0 0% 0% / 0.15);
  }

  /* In dark theme, soften the same shadows */
  :root[data-theme="dark"] .shadow-xl,
  :root[data-theme="dark"] .shadow-2xl {
    box-shadow: 0 20px 25px -5px hsl(0 0% 0% / 0.35);
  }
</style>
